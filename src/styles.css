:root { font-family: Inter, system-ui, sans-serif; }
* { box-sizing: border-box; }
html, body, #app { margin: 0; height: 100%; }
body.dark { background: #0f172a; color: #e2e8f0; }
body.light { background: #f8fafc; color: #0f172a; }

.topbar {
  padding: max(0.75rem, env(safe-area-inset-top)) 1rem 0.75rem;
  border-bottom: 1px solid rgba(148,163,184,0.35);
  display: flex;
  gap: .75rem;
  justify-content: space-between;
  flex-wrap: wrap;
}
.topbar h1 { margin: 0; font-size: clamp(1.1rem,2vw,1.4rem); }
.toolbar { display: flex; gap: .45rem; flex-wrap: wrap; }
button, .file-label, input, textarea, select {
  border-radius: 10px;
  border: 1px solid rgba(148,163,184,0.45);
  background: rgba(15,23,42,0.08);
  color: inherit;
  padding: .55rem .7rem;
}
button, .file-label { cursor: pointer; font-weight: 600; }
.file-label input { display: none; }

.layout {
  height: calc(100% - 72px);
  display: grid;
  grid-template-columns: minmax(0,1fr) 340px;
}
#canvas-wrap { position: relative; overflow: hidden; touch-action: pan-x pan-y; background: radial-gradient(circle at top, rgba(56,189,248,.14), transparent 45%); }
.canvas-hud { position: absolute; top: .6rem; left: .6rem; z-index: 10; display: flex; gap: .4rem; align-items: center; }
#search-node { min-width: 220px; }
#status { font-size: .82rem; background: rgba(15,23,42,.45); color: #e2e8f0; border-radius: 8px; padding: .25rem .45rem; }
#viewport { position: absolute; inset: 0; transform-origin: 0 0; }
#canvas { position: relative; width: 2600px; height: 1700px; }
#edges { position: absolute; inset: 0; width: 2600px; height: 1700px; pointer-events: none; }

.node {
  position: absolute;
  min-width: 180px;
  max-width: 280px;
  padding: .65rem .8rem;
  border-radius: 12px;
  color: #fff;
  font-weight: 700;
  user-select: none;
  touch-action: none;
  box-shadow: 0 6px 20px rgba(0,0,0,.22);
  display: grid;
  grid-template-columns: 1fr auto;
  gap: .4rem;
  align-items: center;
}
.node-main {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.node-meta {
  grid-column: 1 / -1;
  display: flex;
  gap: .35rem;
  flex-wrap: wrap;
}
.badge {
  font-size: .68rem;
  background: rgba(255,255,255,.2);
  border-radius: 999px;
  padding: .1rem .4rem;
}
.collapse-toggle {
  border: none;
  background: rgba(255,255,255,.2);
  color: #fff;
  width: 1.35rem;
  height: 1.35rem;
  border-radius: 999px;
  padding: 0;
  line-height: 1;
}
.node.active { outline: 3px solid #38bdf8; }
.node.search-hit { box-shadow: 0 0 0 3px #f59e0b; }

.sidepanel { border-left: 1px solid rgba(148,163,184,0.3); padding: 1rem; overflow: auto; }
.editor { display: grid; gap: .75rem; }
.editor label { display: grid; gap: .35rem; font-weight: 600; }
.danger { border-color: #ef4444; color: #ef4444; }
.ghost { background: transparent; }

.modal {
  width: min(520px, calc(100vw - 2rem));
  border: 1px solid rgba(148,163,184,0.5);
  border-radius: 14px;
  padding: 1rem;
  background: #0b1222;
  color: #e2e8f0;
}
body.light .modal { background: #fff; color: #0f172a; }
.modal::backdrop { background: rgba(2, 6, 23, .55); }
.modal-actions, .command-list { display: grid; gap: .5rem; margin: .75rem 0; }
.command-list { max-height: 280px; overflow: auto; }
.command-item { text-align: left; }

@media (max-width: 960px) {
  .layout { grid-template-columns: 1fr; grid-template-rows: minmax(0,1fr) auto; height: calc(100% - 120px); }
  .sidepanel { border-left: none; border-top: 1px solid rgba(148,163,184,0.3); max-height: 42vh; padding-bottom: max(.8rem, env(safe-area-inset-bottom)); }
  .canvas-hud { right: .6rem; left: .6rem; }
  #search-node { min-width: 0; flex: 1; }
  button, .file-label { flex: 1; min-width: 88px; text-align: center; }
}
